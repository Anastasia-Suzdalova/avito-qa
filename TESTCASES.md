# Автоматизированные тесты API

[Тест-кейсы API в формате .xlsx](https://docs.google.com/spreadsheets/d/1pL5-3T6A66PYC96rbu2MRu-wYTn4BHhtt5OOyKCjnow/edit?gid=2006427015#gid=2006427015)

## Запуск
Запуск производится из-под `docker-compose` с помощью команды:
```
docker-compose up --build
```
Запуск из-под `docker-compose` обусловен тем, что нужно, чтобы всё необходимое окружение было поднято в контейнере + необходимые пакеты сразу установлены

## Создание объявления
* Используется метод POST, `api url - /api/1/item`
* В теле запроса должны обязательно присутствовать поля:
    * sellerID - integer
    * name - string
    * price - integer

### А1 -- Создание объявления
Тело запроса:
```json
{
    "sellerID": 515515,
    "name": "item1",
    "price": 500
}
```
Ожидаемый результат:
* Статус: `200`
* Body:
    ```json
    {"status": "Сохранили объявление - {uuid}"}
    ```
    uuid -- уникальный id объявления

### А2 -- Создание объявления с отсутствующим sellerID
Тело запроса:
```json
{
    "name": "item1",
    "price": 500
}
```
Ожидаемый результат:
* Статус: `400`

### А3 -- Создание объявления с отсутствующим name
Тело запроса:
```json
{
    "sellerID": 515515,
    "price": 500
}
```
Ожидаемый результат:
* Статус: `400`

### А4 -- Создание объявления с отсутствующим price
Тело запроса:
```json
{
    "sellerID": 515515,
    "name": "item1"
}
```
Ожидаемый результат:
* Статус: `400`

### А5 -- Создание объявления с недопустимым sellerID
**Условия:** передаем строку вместо числа
Тело запроса:
```json
{
    "sellerID": "515515",
    "name": "item1",
    "price": 500
}
```
Ожидаемый результат:
* Статус: `400`

### А6 -- Создание объявления с недопустимым name
**Условия:** передаем число вместо строки
Тело запроса:
```json
{
    "sellerID": 515515,
    "name": 500,
    "price": 500
}
```
Ожидаемый результат:
* Статус: `400`

### А7 -- Создание объявления с недопустимым price
**Условия:** передаем строку вместо числа
Тело запроса:
```json
{
    "sellerID": 515515,
    "name": "item1",
    "price": "500"
}
```
Ожидаемый результат:
* Статус: `400`

### А8 -- Создание объявления с недопустимым sellerID
**Условия:** передаем отрицательное число
Тело запроса:
```json
{
    "sellerID": -515515,
    "name": "item1",
    "price": 500
}
```
Ожидаемый результат:
* Статус: `400`

### А9 -- Создание объявления с недопустимым price
**Условия:** передаем отрицательное число
Тело запроса:
```json
{
    "sellerID": 515515,
    "name": "item1",
    "price": -500
}
```
Ожидаемый результат:
* Статус: `400`

### А10 -- Создание нескольких объявлений от одного пользователя
Тело запроса:
```json
{
    "sellerID": 515515,
    "name": "item1",
    "price": 500
}
```
Ожидаемый результат:
* Статусы запросов: `200`
* uuid первого запроса отличается от uuid второго запроса

## Получение объявления по itemID
* Используется метод **GET**, `api url - /api/1/item/{itemID}`
* Тело запроса отсутствует
* **Пререквезит**: в каждом тесте создаем объявление, извлекаем оттуда uuid, по нему пробуем получить объявление и достать оттуда данные
* Тело запроса на создание объявления в каждом тест-кейсе:
    ```json
    {
        "sellerID": 515515,
        "name": "item1",
        "price": 500
    }
    ```
* Пример тела ответа:
    ```json
    [
        {
            "createdAt":"2025-02-16 20:41:28.060119 +0300 +0300",
            "id":"9a8eec66-9512-4aed-ae39-c573540ddfe9",
            "name":"dsdsd",
            "price":500,
            "sellerId":515515,
            "statistics":{
                "contacts":0,
                "likes":0,
                "viewCount":0
            }
        }
    ]
    ```
### A11 -- Создание и получение объявления по itemID
Действия:
* Создаем объявление
* Извлекаем оттуда `uuid`
* Заменяем в `/api/1/item/{itemID}` itemID на полученный в предыдущем шаге `uuid` и делаем запрос

Ожидаемый результат:
* Статус: `200`

### A12 -- Проверка, что поле `id` ответа соответствует `uuid` из ответа о создании объявления
Действия:
* Создаем объявление
* Извлекаем оттуда `uuid`
* Заменяем в `/api/1/item/{itemID}` itemID на полученный в предыдущем шаге `uuid` и делаем запрос
* Проверяем соответствие `id` ответа с `uuid`

Ожидаемый результат:
* Статус: `200`
* Поле `id` ответа соответствует `uuid` из ответа на запрос о создании объявления

### A13 -- Проверка, что поле `name` ответа соответствует `name` из запроса создания объявления
Действия:
* Создаем объявление
* Заменяем в `/api/1/item/{itemID}` itemID на полученный в предыдущем шаге `uuid` и делаем запрос
* Проверяем соответствие `name` ответа с `name` из запроса создания объявления

Ожидаемый результат:
* Статус: `200`
* Поле `name` ответа соответствует `name` из запроса создания объявления

### A14 -- Проверка, что поле `price` ответа соответствует `price` из запроса создания объявления
Действия:
* Создаем объявление
* Заменяем в `/api/1/item/{itemID}` itemID на полученный в предыдущем шаге `uuid` и делаем запрос
* Проверяем соответствие `price` ответа с `price` из запроса создания объявления

Ожидаемый результат:
* Статус: `200`
* Поле `price` ответа соответствует `price` из запроса создания объявления

### A15 -- Проверка, что поле `createdAt` ответа соответствует текущей дате
Действия:
* Создаем объявление
* Заменяем в `/api/1/item/{itemID}` itemID на полученный в предыдущем шаге `uuid` и делаем запрос
* Проверяем соответствие поля `createdAt` текущей дате

Ожидаемый результат:
* Статус: `200`
* Поле `createdAt` соответствует текущей дате

### A16 -- Проверка, что если есть поле `statistics` ответа, то есть все необходимые поля с соответствующими типами
Действия:
* Создаем объявление
* Заменяем в `/api/1/item/{itemID}` itemID на полученный в предыдущем шаге `uuid` и делаем запрос
* Проверяем что структура `statistics` содержит все необходимые поля с соответствующими типами:
    * likes - `integer`
    * viewCount - `integer`
    * contacts - `integer`

Ожидаемый результат:
* Статус: `200`
* Структура `statistics` содержит все необходимые поля с соответствующими типами

### A17 -- Проверка, что `sellerId` соответствует передаваемому
Действия:
* Создаем объявление
* Заменяем в `/api/1/item/{itemID}` itemID на полученный в предыдущем шаге `uuid` и делаем запрос
* Проверяем соответствие `sellerId` ответа с `sellerId` из запроса создания объявления

Ожидаемый результат:
* Статус: `200`
* `sellerId` ответа соответствует `sellerId` из запроса создания объявления

### A18 -- Проверка передачи пустого `itemID`
Действия:
* Делаем запрос `/api/1/item/`

Ожидаемый результат:
* Статус: `404`

### A19 -- Проверка передачи несуществующего `itemID`
Действия:
* Создаем объявление
* Меняем последний символ в полученном `uuid`
* Заменяем в `/api/1/item/{itemID}` itemID на измененный в предыдущем шаге `uuid`

Ожидаемый результат:
* Статус: `404`

### A20 -- Проверка передачи `itemID` несоответствующему формату `uuid` (серая зона)
Действия:
* Заменяем в `/api/1/item/{itemID}` itemID на любую рандомную строку

Ожидаемый результат:
Фактический результат:
* Статус: `404`

## Получение всех объявлений по `sellerId` продавца
* Используется метод **GET**, `api url - /api/1/{sellerID}/item/`
* Тело запроса отсутствует
* **Пререквезит**: в каждом тесте создаем объявление, извлекаем оттуда uuid, по нему пробуем получить объявления продавца и достать данные из последнего созданного
* Тело запроса на создание объявления в каждом тест-кейсе:
    ```json
    {
        "sellerID": 515515,
        "name": "item1",
        "price": 500
    }
    ```
* Пример тела ответа:
    ```json
    [
        {
            "createdAt":"2025-02-16 21:10:05.567921 +0300 +0300",
            "id":"dsdsd",
            "name":"757889cc-b22e-4402-a7f0-9971b4c831f6",
            "price":500,
            "sellerId":515515,
            "statistics":{
                "contacts":0,
                "likes":0,
                "viewCount":0
            }
        },
        {
            "createdAt":"2025-02-16 21:10:06.74118 +0300 +0300",
            "id":"dsdsd",
            "name":"a2757cfc-e139-4c3f-b969-69961d252a58",
            "price":500,
            "sellerId":515515,
            "statistics":{
                "contacts":0,
                "likes":0,
                "viewCount":0
            }
        }
    ]
    ```
    
### A21 -- Проверка корректности запроса при существующем `sellerID` 
Действия:
* Создаем объявление
* Заменяем в `/api/1/{sellerID}/item` sellerID на sellerID из запроса создания объявления
* Проверяем, что запрос успешно выполнен
* Проверяем, что количество объявлений больше нуля

Ожидаемый результат:
* Статус: `200`
* Количество объявлений больше нуля

### A22 -- Проверка, что у последнего объявления поле `id` соответствует `uuid` из ответ на запрос создания объявления
Действия:
* Создаем объявление
* Извлекаем `uuid` из ответа на запрос о создании объявления
* Заменяем в `/api/1/{sellerID}/item` sellerID на sellerID из запроса создания объявления
* Проверяем, что запрос успешно выполнен
* Проверяем, что количество объявлений больше нуля
* Проверяем, что поле `id` последнего объявления соответствует `uuid` из ответа на запрос о создании объявления

Ожидаемый результат:
* Статус: `200`
* Количество объявлений больше нуля
* Поле `id` последнего объявления соответствует полю `uuid` из ответа на запрос о создании объявления

### A23 -- Проверка, что у последнего объявления поле `name` соответствует полю `name` из запроса создания объявления
Действия:
* Создаем объявление
* Заменяем в `/api/1/{sellerID}/item` sellerID на sellerID из запроса создания объявления
* Проверяем, что запрос успешно выполнен
* Проверяем, что количество объявлений больше нуля
* Проверяем, что поле `name` последнего объявления ответа соответствует полю `name` из запроса создания объявления

Ожидаемый результат:
* Статус: `200`
* Количество объявлений больше нуля
* Поле `name` последнего объявления ответа соответствует полю `name` из запроса создания объявления

### A24 -- Проверка, что у последнего объявления поле `price` соответствует полю `price` из запроса создания объявления
Действия:
* Создаем объявление
* Заменяем в `/api/1/{sellerID}/item` sellerID на sellerID из запроса создания объявления
* Проверяем, что запрос успешно выполнен
* Проверяем, что количество объявлений больше нуля
* Проверяем, что поле `price` последнего объявления ответа соответствует полю `price` из запроса создания объявления

Ожидаемый результат:
* Статус: `200`
* Количество объявлений больше нуля
* Поле `price` последнего объявления ответа соответствует полю `price` из запроса создания объявления

### A25 -- Проверка, что у последнего объявления поле `createdAt` соответствует текущей дате
Действия:
* Создаем объявление
* Заменяем в `/api/1/{sellerID}/item` sellerID на sellerID из запроса создания объявления
* Проверяем, что запрос успешно выполнен
* Проверяем, что количество объявлений больше нуля
* Проверяем, что поле `createdAt` последнего объявления ответа, если оно существует, соответствует текущей дате

Ожидаемый результат:
* Статус: `200`
* Количество объявлений больше нуля
* Поле `createdAt` последнего объявления ответа соответствует текущей дате

### A26 -- Проверка, что у последнего объявления поле `createdAt` соответствует текущей дате
Действия:
* Создаем объявление
* Заменяем в `/api/1/{sellerID}/item` sellerID на sellerID из запроса создания объявления
* Проверяем, что запрос успешно выполнен
* Проверяем, что количество объявлений больше нуля
* Проверяем, что поле `createdAt` последнего объявления ответа, если оно существует, соответствует текущей дате

Ожидаемый результат:
* Статус: `200`
* Количество объявлений больше нуля
* Поле `createdAt` последнего объявления ответа соответствует текущей дате

### A26 -- Проверка, что у последнего объявления поле `statistics` имеет все необходимые поля с соответствующими типами
Действия:
* Создаем объявление
* Заменяем в `/api/1/{sellerID}/item` sellerID на sellerID из запроса создания объявления
* Проверяем, что запрос успешно выполнен
* Проверяем, что количество объявлений больше нуля
* Проверяем что структура statistics последнего объявления содержит все необходимые поля с соответствующими типами:
    * likes - `integer`
    * viewCount - `integer`
    * contacts - `integer`

Ожидаемый результат:
* Статус: `200`
* Количество объявлений больше нуля
* Поле `statistics` последнего объявления ответа имеет все необходимые поля с соответствующими типами

## Получение статистики объявления по `itemID`
* Используется метод **GET**, `api url - /api/1/statistics/{itemID}/`
* Тело запроса отсутствует
* **Пререквезит**: в каждом тесте создаем объявление, извлекаем оттуда uuid, по нему пробуем получить объявление продавца
* Тело запроса на создание объявления в каждом тест-кейсе:
    ```json
    {
        "sellerID": 515515,
        "name": "item1",
        "price": 500
    }
    ```
* Пример тела ответа:
    ```json
    [
        "statistics":{
            "contacts":0,
            "likes":0,
            "viewCount":0
        }
    ]
    ```
    
### A27 -- Проверка, что у объявления поле `statistics` имеет все необходимые поля с соответствующими типами
Действия:
* Создаем объявление
* Извлекаем из ответа `uuid`
* Заменяем в `/api/1/statistics/{itemID}/` itemID на `uuid` из ответа на запрос создания объявления
* Проверяем, что запрос успешно выполнен
* Проверяем что структура statistics последнего объявления содержит все необходимые поля с соответствующими типами:
    * likes - `integer`
    * viewCount - `integer`
    * contacts - `integer`

Ожидаемый результат:
* Статус: `200`
* Поле `statistics` последнего объявления ответа имеет все необходимые поля с соответствующими типами

### A28 -- Проверка передачи пустого `itemID` в запрос получения статистики объявления
Действия:
* Делаем запрос `/api/1/statistics`

Ожидаемый результат:
* Статус: `404`

### A29 -- Проверка передачи несуществующего `itemID` в запрос получения статистики объявления
Действия:
* Создаем объявление
* Меняем последний символ в полученном `uuid`
* Заменяем в `/api/1/item/{itemID}` itemID на измененный в предыдущем шаге `uuid`

Ожидаемый результат:
* Статус: `404`

### A30 -- Проверка передачи `itemID` несоответствующему формату `uuid` в запрос получения статистики объявления (серая зона)
Действия:
* Заменяем в `/api/1/item/{itemID}` itemID на любую рандомную строку

Ожидаемый результат:
Фактический результат:
* Статус: `404`

